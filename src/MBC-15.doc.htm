<!DOCTYPE html>
<html>
<head>
    <title>[#MBC-15] Выставить скрипт проверки Прокси в крон</title>
    <meta http-equiv="Content-Type" Content="application/vnd.ms-word; charset=UTF-8">
        <style type="text/css">

.tableBorder, .grid
{
    background-color: #fff;
    width: 100%;
    border-collapse: collapse;
}

.tableBorder td, .grid td
{
    vertical-align: top;
    padding: 2px;
    border: 1px solid #ccc;
}

.noPadding
{
    padding: 0 !important;
}

h3 .subText
{
    font-size: 60%;
    font-weight: normal;
}

.tabLabel
{
    font-weight: bold;
    border: 1px solid #ccc;
    border-bottom:none;
    padding: 2px;
    display: inline;
}

td.blank
{
    padding: 0;
    margin: 0;
}

.blank td
{
    border: none;
}

#descriptionArea
{
    margin: 0;
    padding: 2px;
    border: 1px solid #ccc;
}

hr
{
    border-top:1px solid #aaa;
}

hr.fullcontent
{
  height: 15px;
  padding: 10px 0;
  background: #fff url('https://adagency.atlassian.net/images/icons/hr.gif') no-repeat scroll center;
}

</style>

</head>
<body>

<table class="tableBorder" cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
        <td bgcolor="#f0f0f0" width="100%" colspan="2" valign="top">
                            <h3 class="formtitle">
                        [MBC-15]&nbsp;<a href="https://adagency.atlassian.net/browse/MBC-15">Выставить скрипт проверки Прокси в крон</a>
            <span class="subText">
               Created: 22/Feb/17                   &nbsp;Updated: 13/Jul/17

                                                    &nbsp;Resolved: 23/Feb/17
                            </span>
            </h3>
        </td>
    </tr>
    <tr>
        <td width="20%"><b>Status:</b></td>
        <td width="80%">Done</td>
    </tr>
    <tr>
        <td width="20%"><b>Project:</b></td>
        <td width="80%"><a href="https://adagency.atlassian.net/secure/BrowseProject.jspa?id=10100">MixTraff CRM</a></td>
    </tr>

        <tr>
            <td><b>Component/s:</b></td>
            <td>
                            None
                </td>
    </tr>
    

        <tr>
            <td><b>Affects Version/s:</b></td>
            <td>
                            None
                </td>
    </tr>
    

        <tr>
            <td><b>Fix Version/s:</b></td>
            <td>
                            None
                </td>
    </tr>
    
    </table>

<br />
<table class="grid" cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
        <td bgcolor="#f0f0f0" valign="top" width="20%">
            <b>Type:</b>
        </td>
        <td bgcolor="#ffffff" valign="top"  width="30%" >
            Task
        </td>

                    <td bgcolor="#f0f0f0">
                <b>Priority:</b>
            </td>
            <td bgcolor="#ffffff" valign="top" nowrap>
                Medium
            </td>
            </tr>
    <tr>
                        <td bgcolor="#f0f0f0" valign="top" width="20%">
                <b>Reporter:</b>
            </td>
            <td bgcolor="#ffffff" valign="top"  width="30%" >
                                            <a class="user-hover" rel="4841601" id="word_reporter_4841601" href="https://adagency.atlassian.net/secure/ViewProfile.jspa?name=4841601">yybitb</a>
                            </td>
        
                    <td bgcolor="#f0f0f0" width="20%">
                <b>Assignee:</b>
            </td>
            <td bgcolor="#ffffff" valign="top" nowrap  width="30%" >
                                            <a class="user-hover" rel="4841601" id="word_assignee_4841601" href="https://adagency.atlassian.net/secure/ViewProfile.jspa?name=4841601">yybitb</a>
                            </td>
            </tr>
    	<tr>
		<td bgcolor="#f0f0f0" width="20%">
			<b>Resolution:</b>
		</td>
		<td bgcolor="#ffffff" valign="top" width="30%" nowrap>
                            Done
                    </td>
                    <td bgcolor="#f0f0f0" width="20%">
                <b>Votes:</b>
            </td>
            <td bgcolor="#ffffff" valign="top" width="30%" nowrap>
                0
            </td>
        
    </tr>
    
        <tr>
        <td bgcolor="#f0f0f0" width="20%">
            <b>Labels:</b>
        </td>
        <td id="labels-11900-value" class="value" bgcolor="#ffffff" valign="top" colspan="3" nowrap>
                            None
                    </td>
    </tr>
    
    	<tr>
        		<td bgcolor="#f0f0f0" width="20%"><b>Remaining Estimate:</b></td>
        <td bgcolor="#ffffff" valign="top" nowrap width="80%" colspan="3">
                            Not Specified
            		</td>
    </tr>
    <tr>
                <td bgcolor="#f0f0f0" width="20%"><b>Time Spent:</b></td>
		<td bgcolor="#ffffff" valign="top" nowrap width="80%" colspan="3">
                            Not Specified
            		</td>
	</tr>
    <tr>
                <td bgcolor="#f0f0f0" width="20%"><b>Original Estimate:</b></td>
		<td bgcolor="#ffffff" valign="top" nowrap width="80%" colspan="3">
                            Not Specified
            		</td>
    </tr>
    
    </table>



    <br />

    	<table class="grid" cellpadding="0" cellspacing="0" border="0" width="100%">
            

        
    



</table>

    <br/>

    <table cellpadding="2" cellspacing="0" border="0" width="100%" align="center">
    <tr>
        <td bgcolor="#bbbbbb" width="1%" nowrap align="center">
            &nbsp;<font color="#ffffff"><b>Description</b></font>&nbsp;
        </td>
        <td>&nbsp;</td>
    </tr>
    </table>

    <table cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
        <td id="descriptionArea">
            <p>Задача: выставить скрипт проверки Прокси в крон, результаты выводить в сводку Логов.</p>

<p>Последняя проверка прокси выдала всего 1 годный (выданный вчера под парсинг Яндекса), <a href="https://bitbucket.org/adagencyuser/dcrm/issues/1" class="external-link" rel="nofollow">остальные 52 из ТЗ</a>, годные несколько мес назад выдают "timeout error": </p>


<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>Check proxy: 178.33.0.75:3752
 Bad proxy, code: Error: 28: Connection timed out after 4003 milliseconds
Check proxy: 37.59.183.134:3752
 Bad proxy, code: Error: 28: Connection timed out after 4001 milliseconds
Check proxy: 92.222.123.175:3752
 Bad proxy, code: Error: 28: Connection timed out after 4001 milliseconds
Check proxy: 37.187.158.56:3752
 Proxy OK, data length: 84481

</pre>
</div></div>
            <br/>
        </td>
    </tr>
    </table>

    <br/>

    <table cellpadding="2" cellspacing="0" border="0" width="100%" align="center">
    <tr>
        <td bgcolor="#bbbbbb" width="1%" nowrap align="center">
            &nbsp;<font color="#ffffff"><b>Comments</b></font>&nbsp;
        </td>
        <td>&nbsp;</td>
    </tr>
    </table>

    <table cellpadding="0" cellspacing="0" border="0" width="100%" class="grid" style="margin: 0;">
                <tr id="comment-header-11603"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="denys" id="word_commented_denys" href="https://adagency.atlassian.net/secure/ViewProfile.jspa?name=denys">Denys Shadow</a>
                                        <font size="-2">
            [
                <font color="#336699">22/Feb/17</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-11603"><td bgcolor="#ffffff">
            <p>для XML яндекса, которое я давал , <b>НЕ НУЖНЫ ПРОКСИ ВООБЩЕ</b><br/>
там на данный момент 3300 запросов \ сутки можно делать .<br/>
запрос к АПИ яндекса должен оуществляться с ИП сервера, т.к. там привязка ! </p>

<p>детали по XML находятся в этом тикете : <a href="https://adagency.atlassian.net/projects/MBC/issues/MBC-14" class="external-link" rel="nofollow">https://adagency.atlassian.net/projects/MBC/issues/MBC-14</a></p>
        </td></tr>
                <tr id="comment-header-11608"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="4841601" id="word_commented_4841601" href="https://adagency.atlassian.net/secure/ViewProfile.jspa?name=4841601">yybitb</a>
                                        <font size="-2">
            [
                <font color="#336699">22/Feb/17</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-11608"><td bgcolor="#ffffff">
            <p>запрос скриптом напрямую дает <b>error</b> </p>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>[value] =&gt; Запрос пришёл с IP-адреса 2001:41d0:a:5e38::, не входящего в список разрешённых для данного пользователя
</pre>
</div></div>


<p>запрос скриптом через указанный адрес <b><a href="http://admincrm.mixtraff.com/?r=proxy/index&amp;Proxy%5Bid%5D=53&amp;Proxy%5Bproxy%5D=&amp;Proxy%5Bccode%5D=&amp;Proxy%5Bcheck_time%5D=&amp;Proxy%5Bcheck_status%5D=&amp;Proxy%5Busername%5D=&amp;Proxy%5Bpassword%5D=&amp;Proxy%5Btype%5D=&amp;Proxy%5Bcreate_time%5D=&amp;Proxy%5Bactive%5D=&amp;Proxy_page=1&amp;ajax=proxy-grid&amp;sort=id" class="external-link" rel="nofollow">как прокси</a></b> (geo = FR) ref "привязка к ИП 37.187.158.56" давал вчера ОК</p>
        </td></tr>
                <tr id="comment-header-11617"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="denys" id="word_commented_denys" href="https://adagency.atlassian.net/secure/ViewProfile.jspa?name=denys">Denys Shadow</a>
                                        <font size="-2">
            [
                <font color="#336699">22/Feb/17</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-11617"><td bgcolor="#ffffff">
            <p>по неизвестным причинам яндекс перешел на ипв6 о_0. перепривязал , теперь все ок , пример : <a href="http://crm.mixtraff.com/phpinfo.php" class="external-link" rel="nofollow">http://crm.mixtraff.com/phpinfo.php</a></p>
        </td></tr>
                <tr id="comment-header-11618"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="4841601" id="word_commented_4841601" href="https://adagency.atlassian.net/secure/ViewProfile.jspa?name=4841601">yybitb</a>
                                        <font size="-2">
            [
                <font color="#336699">22/Feb/17</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-11618"><td bgcolor="#ffffff">
            <p>комит a61b9f99ec34 - </p>

<ol>
	<li>добавил скрипт проверки прокси в <b>крон</b> (выполняется 1 раз / час по 500 шт)</li>
	<li>результаты выполнения отображаются в <b>сводке логов</b> (раздел Прокси)</li>
	<li>прокси, дающие ошибку на проверке, помечаются как <b>неактивные</b></li>
</ol>

        </td></tr>
                <tr id="comment-header-17601"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="4841601" id="word_commented_4841601" href="https://adagency.atlassian.net/secure/ViewProfile.jspa?name=4841601">yybitb</a>
                                        <font size="-2">
            [
                <font color="#336699">13/Jul/17</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-17601"><td bgcolor="#ffffff">
            <p>Комит 5c5e715fb - вставка новых прокси из списка АПИ (GET запрос) в БД</p>
        </td></tr>
            </table>
Generated at Thu Sep 14 07:15:22 UTC 2017 by yybitb using JIRA 1001.0.0-SNAPSHOT#100059-sha1:5bc2bce065aebd69bf5a23bc3efdd94fd09dddc8.

</body>
</html>